---
title: Package documentation in R
author: 'Nikita Gusarov'
date: '2022-02-11'
slug: []
categories: [Programming]
tags: [Programming, R, roxygen2, Documentation]
featured_image: '/images/roxygen-0.png'
description: ''
---

<script src="{{< blogdown/postref >}}index_files/header-attrs/header-attrs.js"></script>


<p>Previously we have seen how to create a package: how to structure your code, what files to include and how to test your code.
The next step in package creation is the documentation.
We have spoken about its existence, but only briefly.
Now we have some more time to describe the documentation mantaince procedure more in detail.
For this we are going to use the <a href="https://roxygen2.r-lib.org/"><code>roxygen2</code></a> package, which is included in <code>devtool</code> suite.</p>
<div id="documentation-within-package" class="section level2">
<h2>Documentation within package</h2>
<p>The documentation by convention is stored in the <code>man</code> folder of the package’s root directory.
By default, one can populate this folder by hand, which means writting and mantaining multiple documentation entries.
The <code>help</code> files are stored in plain text format inside separate <code>.Rd</code> (<em>R</em> documentation) files.</p>
<p>Let’s create a simple testing package, like in previous posts and take a look at examples generated by <code>package.skeleton()</code> function.
We start by loading the <code>devtools</code> meta-package:</p>
<pre class="r"><code># Load packages
library(devtools)</code></pre>
<pre><code>## Le chargement a nécessité le package : usethis</code></pre>
<p>Then we create our simple function and wrap it into package:</p>
<pre class="r"><code># Create function
my_function = function() {
    cat(&quot;Hello world!&quot;)
}

# Create package
package.skeleton(
    name = &quot;mypackage&quot;,
    list = &quot;my_function&quot;,
    path = &quot;.&quot;,
    encoding = &quot;UTF-8&quot;
)</code></pre>
<p>We then change our working directory for then newly created package’s root location:</p>
<pre class="r"><code># Move to package location
setwd(&quot;mypackage&quot;)</code></pre>
<p>Don’t forget to unlink the already preloaded function from your environment, before working with the package:</p>
<pre class="r"><code>rm(list = c(&quot;my_function&quot;))</code></pre>
<p>Now let’s take a look at the contents of the <code>man</code> folder:</p>
<pre class="r"><code># List files in man
list.files(&quot;man&quot;)</code></pre>
<pre><code>## [1] &quot;my_function.Rd&quot;       &quot;mypackage-package.Rd&quot;</code></pre>
<p>We see two documentation entries: one for our newly created function and another one with general description of our package.
But how those files are organised from within?
We can take a peek at their contents:</p>
<pre class="r"><code># First several lines
content = readLines(&quot;man/my_function.Rd&quot;)

# Print results
cat(content[1:5], sep = &quot;\n&quot;)</code></pre>
<pre><code>## \name{my_function}
## \alias{my_function}
## %- Also NEED an &#39;\alias&#39; for EACH other topic documented here.
## \title{
## %%  ~~function to do ... ~~</code></pre>
<p>The contents of package description (the <code>man/mypackage-package.Rd</code>) file look quite similar:</p>
<div class="figure">
<img src="/images/roxygen-0.png" alt="" />
<p class="caption">Package description</p>
</div>
<p>As you can notice, the format look a lot like LaTeX.
In fact <code>.Rd</code> files are a special file format based on LaTeX, which can be processed into a variety of formats, including LaTeX, HTML and plain text.
One can read more about this format <a href="https://cran.r-project.org/doc/manuals/R-exts.html#Rd-format">on CRAN</a>.
Unfortunately for us, editing such documents becomes very inconvenient once you have a lot of objects and functionnalities in your package.
Obviously, it does not pose any difficulty to edit this files by hand in our case, but for larger projects it will become tiresome very fast.
To mitigate this problem, we can use the <code>roxygen2</code> package.</p>
<p>But before proceeding with <code>roxygen2</code> usage, we should perform some additional steps.
The package will never overwrite the existing documentation, which is assumed to be written by user.
Before <code>roxygen2</code> will be able to write the changes we will need to delete the files created by the <code>package.skeleton()</code> function:</p>
<pre class="r"><code># Remove existing dovumentation
file.remove(c(
    &quot;man/my_function.Rd&quot;,
    &quot;NAMESPACE&quot;
))</code></pre>
</div>
<div id="using-roxygen2" class="section level2">
<h2>Using <code>roxygen2</code></h2>
<p>How does <code>roxygen2</code> (or simply <code>roxygen</code>) work?
This is a toolset based on <code>oxygen</code> - a simple documentation toolset.
A nice and synthetic description may be found on the <a href="https://roxygen2.r-lib.org/">project’s website</a>:</p>
<blockquote>
<p>describe your functions in comments next to their definitions and <code>roxygen2</code> will process your source code and comments to automatically generate
<code>.Rd</code> files in <code>man</code>, <code>NAMESPACE</code>, and, if needed, the <code>Collate</code> field in <code>DESCRIPTION</code>.</p>
</blockquote>
<p>The package brings us an extremely usefull feature to write our documentation in the same files as our code.
The comments of a specific format, added to our source <code>.R</code> scripts may be automatically converted into the documentation.
Such automated conversion helps to preserve consistency between the packages and respect the style of documentation.</p>
<p>Let’s see how we can add this functionnality to our package.
Don’t forget that for now the contents of our source file (the <code>R/my_function.R</code>) contain only the bare minimum of code without any comments.
They look like:</p>
<pre class="r"><code># Print contents
cat(
    content &lt;- readLines(&quot;R/my_function.R&quot;),
    sep = &quot;\n&quot;
)</code></pre>
<pre><code>## my_function &lt;-
## function() {
##     cat(&quot;Hello world!&quot;)
## }</code></pre>
<p>As one can see: no comments, no documentation.
At this point we can add some inline documentation following the <code>roxygen2</code> convention.
To do so, we should use special comment delimiters: <code>#'</code>.
They will mark which lines should be parced by <code>roxygen2</code>.
For example, we can write following contents to our file</p>
<pre class="r"><code>cat(
    &quot;#&#39; Print &#39;Hello world!&#39;&quot;,
    &quot;#&#39; &quot;,
    &quot;#&#39; @param ... No parameters required&quot;,
    &quot;#&#39; @return Cat &#39;Hello world!&#39; to command line&quot;,
    &quot;#&#39; @examples&quot;,
    &quot;#&#39; my_function()&quot;,
    content,
    sep = &quot;\n&quot;,
    file = &quot;R/my_function.R&quot;
)</code></pre>
<p>Once we have modified the documentation directly inside our source code file, we should use <code>roxygen2</code> to convert it to a <code>.Rd</code> file.
For this we may run:</p>
<pre class="r"><code># Create documentation (roxygen2::)
roxygen2::roxygenise()</code></pre>
<p>This function requires an explicit specification of the <code>roxygen2</code> namespace, which may not be that convenient.
Alternatively one can use the function which is provided by <code>devtools</code>:</p>
<pre class="r"><code># Create documentation (devtools::)
document(quiet = TRUE)</code></pre>
<pre><code>## First time using roxygen2. Upgrading automatically...</code></pre>
<pre><code>## Updating roxygen version in /home/nikita/Documents/Personal/website_source/content/en/post/2022-02-11-package-documentation-in-r/mypackage/DESCRIPTION</code></pre>
<pre><code>## ℹ Loading mypackage</code></pre>
<p>Now we can compare the corresponding <code>.Rd</code> file contents to the ones seen before:</p>
<pre class="r"><code># Print contents
cat(readLines(&quot;man/my_function.Rd&quot;), sep = &quot;\n&quot;)</code></pre>
<pre><code>## % Generated by roxygen2: do not edit by hand
## % Please edit documentation in R/my_function.R
## \name{my_function}
## \alias{my_function}
## \title{Print &#39;Hello world!&#39;}
## \usage{
## my_function()
## }
## \arguments{
## \item{...}{No parameters required}
## }
## \value{
## Cat &#39;Hello world!&#39; to command line
## }
## \description{
## Print &#39;Hello world!&#39;
## }
## \examples{
## my_function()
## }</code></pre>
<p>As we can see, the new documentation <code>.Rd</code> entry corresponds to specification provided in our source file.
Here is an example of how the corresponding entry will be rendered when we call for <code>help()</code> on this function:</p>
<pre class="r"><code># Help file rendering
help(my_function)</code></pre>
<p>Once one becomes familiar with adding documentation to the source files it becomes extremely easy to add and modify the documentation to your <em>R</em> package.</p>
</div>
